<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
	  	<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>学生发布需求</title>
		<link href="/HomeEducationPlatform/static/modules/plugin/bootstrap/bootstrap.min.css" rel="stylesheet"/>
		<!-- ui-choose -->
		<link href="/HomeEducationPlatform/static/modules/plugin/uichoose/ui-choose.css" rel="stylesheet">
		<style>
		/*header style start*/
			.header {
				margin: 0px;
				padding-left: 0px;
				padding-right: 0px;
				/*margin-top: 20px;*/
				padding-top: 26px;
				height: 98px;
				border-bottom: 1px solid rgb(235, 235, 235);
			}
			.header .row {
				height: 42px;
				line-height: 42px;
			}
			.header .row .col-md-2 {
				padding-right: 0px;
				height: 42px;
				letter-spacing: 6px;
				border-right: 1px solid rgb(206, 205, 205);
			}
			.logo {
				font-size: 28px;
				font-weight: 500;
			}
			.poster {
				margin-left: 20px;
				font-size: 23px;
				font-weight: 500;
				letter-spacing: 1px;
			}
		/*header style end*/
		/*content style start*/
			.content {
				margin-top: 50px;
			}
		/*form style start*/
			form {
			 	
			}
			form .row {
				height: 80px;
				/*line-height: 62px;
				vertical-align: middle;*/
			}
			.col-sm-2 label {
				height: 40px;
				line-height: 40px;
			}
			ul.ui-choose>li {
				height: 40px;
				line-height: 40px;
				border: 1px solid rgb(206, 205, 205);
				border-radius: 20px;
				-moz-border-radius: 20px;
				-webkit-border-radius: 20px;
				margin-right: 10px;
			}
			ul.ui-choose>li:first-child {
				border-radius: 20px;
				-moz-border-radius: 20px;
				-webkit-border-radius: 20px;
			}
			ul.ui-choose>li:last-child {
				border-radius: 20px;
				-moz-border-radius: 20px;
				-webkit-border-radius: 20px;
			}
			ul.ui-choose>li:hover {
				border-color: rgb(206, 205, 205);
				color: rgb(51, 51, 51);
			}
			ul.ui-choose>li.selected {
				border-color: rgb(206, 205, 205);
				color: rgb(45, 204, 112);
				border-radius: 20px;
				-moz-border-radius: 20px;
				-webkit-border-radius: 20px;
			}
			.row_left {
				text-align: right;
				padding-right: 25px;
			}
			.row_right {
				padding-left: 25px;
			}
			.row_right .form-control-height {
				height: 40px;
			}
			.row_right input[type=radio] {
				height: 40px;
				line-height: 40px;
				vertical-align: middle;
				margin-right: 5px;
			}
			.labeltext {
				font-size: 16px;
				font-weight: normal;
				/*padding*/
			}
			.form-control {
				border-color: rgb(235, 235, 235);
				width: 80%;
			}
			.radio_label {
				margin-right: 10px;
				font-weight: normal;
			}
			/*radio style start*/
    
			input[type='radio'] {
				width:18px;
				height:18px;
				position:relative;
				background:transparent;
				border:0;
				outline:none;
				appearance:none;
				-webkit-appearance:none;
				-moz-appearance:none;
				margin: 12px 0 0;
			}
			input[type='radio']:before {
				content:"";
				position:absolute;
				width:16px;
				height:16px;
				border:1px solid #999;
				border-radius:100%;
			}
			input[type='radio']:checked:before {
				border:1px solid transparent;
				background:#5ECD62;
			}
			
			input[type='radio']:checked:after {
				content:"";
				position:absolute;
				top:3px;
				left:3px;
				border:2px solid #fff;
				border-radius:100%;
				width:10px;
				height:10px;
				background:#5ECD62;
			}
			.radio_label {
				position: relative;
				top: -5px;
			}
			input[type="radio"],input[type="radio"]:hover,input[type="radio"]:checked{
				border: none !important;
				outline:none !important;
			}
			/*radio style end*/
			.btn_row {
				text-align: center;
				margin-top: 40px;
			}
			.btn {
				width: 30%;
				height: 48px;
				color: #fff;
				font-size: 18px;
				font-weight: 500;
				letter-spacing: 2px;
				background: rgb(45, 204, 112);
				border-radius: 24px;
				-moz-border-radius: 24px;
				-webkit-border-radius: 24px;
			}
			.price_input {
				width: 100px;
			}
			.inlinestyle input {
				display: inline-block;
			}
			li {
				font-size: 15px !important;
			}
			.textarea_row {
				height: 138px !important;
			}
		/*form style end*/
		
		/*content style end*/
		</style>
	</head>
	<body>
		
		<!-- Content START -->
		<div class="content">
			<!-- Container START -->
			<div class="container">
				<!-- Form START -->
			
					<!-- 第一行 START -->
					<div class="row">
						<div class="col-md-2 col-sm-2 row_left">
							<label class="labeltext">用户名</label>
						</div>
						<div class="col-md-10 col-sm-10 row_right">
							<input type="text" class="form-control form-control-height" id="name" readonly="readonly" />
						</div>
					</div>
					<!-- 第一行 END -->
					<!-- 第二行 START -->
					<div class="row">
						<div class="col-md-2 col-sm-2 row_left">
							<label class="labeltext">密码</label>
						</div>
						<div class="col-md-10 col-sm-10 row_right">
							<input type="password" class="form-control form-control-height" id="password" onblur="checkPass()"/>
						</div>
					</div>
					<!-- 第二行 END -->
					<!-- 第三行 START -->
					<div class="row">
						<div class="col-md-2 col-sm-2 row_left">
							<label class="labeltext">新密码</label>
						</div>
						<div class="col-md-10 col-sm-10 row_right">
							<input type="password" class="form-control form-control-height" id="newpass" />
						</div>
					</div>
					<!-- 第三行 END -->
					<!-- 第四行 START -->
					<div class="row">
						<div class="col-md-2 col-sm-2 row_left">
							<label class="labeltext">确认密码</label>
						</div>
						<div class="col-md-10 col-sm-10 row_right">
							<input type="password" class="form-control form-control-height" id="repass" onblur="checknewPass()"/>
						</div>
					</div>
					<!-- 第四行  END -->
					<!-- 第五行 START -->
					<div class="row">
						<div class="col-md-2 col-sm-2 row_left">
							<label class="labeltext">邮箱</label>
						</div>
						<div class="col-md-10 col-sm-10 row_right">
							<input type="email" class="form-control form-control-height" id="email"/>
						</div>
					</div>
					<div class="row">
						<div class="col-md-2 col-sm-2 row_left">
							<label class="labeltext">身份证号</label>
						</div>
						<div class="col-md-10 col-sm-10 row_right">
							<input type="text" class="form-control form-control-height" id="idcard"/>
						</div>
					</div>
					<!-- 第五行 END -->
					
					<div class="row btn_row">
						<button type="button" class="btn" onclick="modifyPass()">保存</button>
					</div>		
				<!-- Form END -->
			</div>
			<!-- Container END -->
		</div>
		<!-- Content END -->
		
		
		<!--Jquery Library-->
	    <script src="/HomeEducationPlatform/static/modules/plugin/jquery/jquery.min.js"></script>
	    <!--Bootstrap core JavaScript-->
	    <script src="/HomeEducationPlatform/static/modules/plugin/bootstrap/bootstrap.min.js"></script>
		<!-- ui-choose -->
		<script src="/HomeEducationPlatform/static/modules/plugin/uichoose/ui-choose.js"></script>
		<script type="text/javascript">
			var password;
			$.ajax({
				url: '/HomeEducationPlatform/parent/getUserInfo',
				type: 'POST',
				dataType: 'json',
				
				}).done(function(data) {
					
					$("#name").val(data.name);
					password = data.password
					$("#email").val(data.email);
					$("#idcard").val(data.idcard);
		        }).fail(function() {
					console.log("错误");
		        	setTimeout("",400);
		        });
		    
			function checkPass() {
				var mypass = $("#password").val();
				if(mypass == password){
					return true;
				}else{
					alert("密码错误，不能修改");
					return false;
				}
				
			}
			function checknewPass(){
				var newpass = $("#newpass").val();
				var repass = $("#repass").val();
				if(newpass == repass){
					return true;
				}else{
					alert("两次密码输入错误，请检查");
					return false;
				}
			}


			function checkIdCard() {
				debugger
				var idCard = $("#idcard").val();
				var regIdCard=
						/(^[1-9]\d{5}(18|19|20)?\d{4}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)/;
				if(regIdCard.test(idCard)){
					if(idCard.length == 18){
						var idCardWi = new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);
						var idCardY = new Array(1,0,'X',9,8,7,6,5,4,3,2);
						var idCardWiSum = 0;
						for(var i = 0; i < 17; i++){
							idCardWiSum += idCard.substring(i,i+1)*idCardWi[i];
						}
						var idCardMod = idCardWiSum%11;
						var idCardLast = idCard.substring(17);
						var ss = idCardY[idCardMod];
						if(idCardLast === ss.toString().toLowerCase()){
							return true;
						}else{
							return false;
						}
					}
				}else{
					return false;
				}
			}
			
			
			function modifyPass(){
				var repass = $("#repass").val();
				var newpass = $("#newpass").val();
				var email = $("#email").val();
				var idcard = $("#idcard").val();
				var mypass = $("#password").val();
				if(mypass != password){
					alert("密码错误，不能修改");
					return false;
				}
				if(newpass != repass){
					alert("两次密码输入错误，请检查");
					return false;
				}
				if(!checkIdCard()){
					alert("身份证号无效，请检查");
					return false;
				}
				$.ajax({
					url: '/HomeEducationPlatform/parent/updateUser',
					type: 'POST',
					dataType: 'json',
					data:{"password":repass,"email":email,"idcard":idcard},
					}).done(function(data) {
						
						var result = data.result;
						if(result ==1){
							alert("修改成功");
						}
			        }).fail(function() {
						console.log("错误");
			        	setTimeout("",400);
			        });
			}
			
		</script>
	</body>
</html>
